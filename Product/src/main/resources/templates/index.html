<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω s·∫£n ph·∫©m</title>
  <!-- Bootstrap CSS -->
   <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      background-color: #f8f9fa;
      font-family: 'Segoe UI', sans-serif;
    }

    .container-main {
      max-width: 1200px;
      margin-top: 40px;
      background-color: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    #key1 {
      border: 2px solid #0d6efd;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      color: #0d6efd;
      background-color: #f8f9fa;
      transition: all 0.3s ease;
    }

    #key1:focus {
      outline: none;
      box-shadow: 0 0 0 0.25rem rgba(13,110,253,.25);
      background-color: #ffffff;
    }

    #key1::placeholder {
      color: #6c757d;
      font-style: italic;
    }

    table th, table td {
      vertical-align: middle;
    }
  </style>
</head>

<body>
<div class="container-main">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-primary">üì¶ Qu·∫£n l√Ω s·∫£n ph·∫©m</h2>
    <button class="btn btn-outline-primary" onclick="window.location.href='/'">üè† Home</button>
  </div>

  <!-- Thanh c√¥ng c·ª• -->
  <div class="row mb-3">
    <div class="col-md-8 d-flex gap-2">
      <input type="text" class="form-control" id="key1" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m...">
      <button class="btn btn-success" onclick="getProduct()">üîç T√¨m ki·∫øm</button>
    </div>

    <div class="col-md-4 text-end">
      <div class="btn-group">
        <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
          ‚ûï Th√™m m·ªõi
        </button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="#" data-bs-toggle="modal"
                 data-bs-target="#productModal" onclick="openAddModal()">Th√™m s·∫£n ph·∫©m</a></li>
          <li><a class="dropdown-item" href="#" data-bs-toggle="modal"
                 data-bs-target="#categoryModal">Th√™m th·ªÉ lo·∫°i</a></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Th√¥ng b√°o -->
  <div th:if="${message}" class="alert alert-success text-center" th:text="${message}"></div>

  <!-- Danh s√°ch s·∫£n ph·∫©m -->
  <h4 class="mt-4 text-primary" >Danh s√°ch s·∫£n ph·∫©m</h4>
  <table class="table table-striped table-hover mt-3"  >
    <thead class="table-dark text-center">
    <tr>
      <th>ID</th>
      <th>T√™n s·∫£n ph·∫©m</th>
      <th>
        <div class="mb-3">
          <label for="categorySelect" class="form-label fw-bold">Danh m·ª•c</label>
          <select id="categorySelect" class="form-select">
            <option value="" disabled selected>-- Ch·ªçn danh m·ª•c --</option>
            <option th:each="c : ${cate}"
                    th:value="${c.id}"
                    th:text="${c.name}">
            </option>
          </select>
        </div>

        <script>
          document.addEventListener("DOMContentLoaded", function () {
            const select = document.getElementById("categorySelect");
            select.addEventListener("change", function () {
              const cateId = this.value;
              if (cateId) {
                // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn URL c√≥ param id
                window.location.href = `/index?id=` + cateId;
              }
            });
          });
        </script>
      </th>
      <th>Gi√°</th>
      <th>S·ªë l∆∞·ª£ng</th>
      <th>H√†nh ƒë·ªông</th>
      <th>M√¥ t·∫£</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="p: ${prd}" th:if=" p != null">
      <td th:text="${p.id}"></td>
      <td th:text="${p.name}"></td>
      <td  th:text="${p.category != null ? p.category.categoryname : 'Kh√¥ng c√≥'}"></td>
      <td th:text="${p.price}"></td>
      <td th:text="${p.quantity}"><</td>
      <td>
        <button class="btn btn-sm btn-warning"
                data-bs-toggle="modal"
                data-bs-target="#productModal"
                th:data-id=     "${p.id}"
                th:data-name=    "${p.name}"
                th:data-price=  "${p.price}"
                th:data-description="${p.description}"
                th:data-quantity ="${p.quantity}"
                th:data-category="${p.category?.id}"
                onclick="openEditModal(this)">‚úèÔ∏è S·ª≠a</button>
        <a class="btn btn-sm btn-danger"
           th:href="@{/product/delete/{id}(id=${p.id})}"
           onclick="return confirm('B·∫°n ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y?')">üóëÔ∏è X√≥a</a>
        <a class="btn btn-sm "

      </td>
      <td>
        <div class="container mt-3">
          <!-- Ph·∫ßn t√≥m t·∫Øt (hi·ªán ban ƒë·∫ßu) -->
          <div id="shortDesc" style="max-height: 20px; overflow: hidden;">
            <p th:text="${p.description}"></p>
          </div>

          <!-- Ph·∫ßn ƒë·∫ßy ƒë·ªß (collapse) -->
          <div class="collapse" id="fullDesc">
            <p th:text="${p.description}"></p>
          </div>

          <a id="bsToggleBtn" class="btn btn-link p-0 mt-2" data-bs-toggle="collapse" href="#fullDesc" role="button"
             aria-expanded="false" aria-controls="fullDesc">
            Xem th√™m
          </a>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
  <!-- Ph√¢n trang -->
  <div class="text-center mt-3">
    <a th:each="i : ${#numbers.sequence(1, totalPages ?: 1)}"
       th:href="@{/product(page=${i}, sortField=${sortField}, sortDir=${sortDir})}"
       th:text="${i}"
       class="btn btn-sm btn-outline-primary m-1"
       th:classappend="${i == currentPage} ? 'active' : ''"></a>

  </div>


  <!-- Danh s√°ch th·ªÉ lo·∫°i -->
  <div>
  <h4 class="mt-5 text-primary">Danh s√°ch th·ªÉ lo·∫°i</h4>
  <table class="table table-bordered table-striped mt-3">
    <thead class="table-dark text-center">
    <tr>
      <th>ID</th>
      <th>T√™n th·ªÉ lo·∫°i</th>
      <th>Mi√™u t·∫£</th>
      <th>H√†nh ƒë·ªông</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="c : ${cate}">
      <td th:text="${c.id}"></td>
      <td th:text="${c.name}"></td>
      <td th:text="${c.description}"></td>
      <td class="text-center">
        <a th:href="@{/category/delete/{id}(id=${c.id})}" class="btn btn-danger btn-sm"
           onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a th·ªÉ lo·∫°i n√†y?')">üóëÔ∏è X√≥a</a>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<!-- Modal Th√™m Th·ªÉ Lo·∫°i-->
<div class="modal fade" id="categoryModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form th:action="@{/create-form2}" method="post" th:object="${cate2}">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Th√™m th·ªÉ lo·∫°i</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">T√™n th·ªÉ lo·∫°i</label>
            <input type="text" class="form-control" th:field="*{Name}" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Mi√™u t·∫£</label>
            <textarea class="form-control" th:field="*{Description}"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">X√°c nh·∫≠n</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal th√™m/s·ª≠a s·∫£n ph·∫©m -->
<div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form th:action="@{/create-form}" method="post" id="productForm" th:object="${prd2}">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="modalTitle"></h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="id" th:field="*{id}">
          <div class="mb-3">
            <label class="form-label">T√™n s·∫£n ph·∫©m</label>
            <input type="text" class="form-control" id="name" th:field="*{name}" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Mi√™u t·∫£</label>
            <textarea class="form-control" id="description" th:field="*{description}"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Gi√°</label>
            <input type="number" class="form-control" id="price" th:field="*{price}" min="1" required>
          </div>
          <div class="mb-3">
            <label class="form-label">S·ªë l∆∞·ª£ng</label>
            <input type="number" class="form-control" id="quantity" th:field="*{quantity}" min="1" required>
          </div>
          <div class="mb-3">
            <label class="form-label"  >Danh m·ª•c</label>
            <select class="form-select" th:field="*{categoryid}" >
              <option value="">-- Ch·ªçn danh m·ª•c --</option>
              <option th:each=" c : ${cate}"
                      th:value= "${c.id}"
                      th:text="${c.name}"></option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">X√°c nh·∫≠n</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
        </div>
      </form>
    </div>
  </div>
</div>
</div>

<script>
  function openAddModal() {
    document.getElementById('modalTitle').innerText = "Th√™m s·∫£n ph·∫©m";
    document.getElementById('id').value = "";
    document.getElementById('name').value = "";
    document.getElementById('description').value = "";
    document.getElementById('price').value = "";
    document.getElementById('quantity').value = "";
    document.getElementById('category').value=""
  }

  function openEditModal(btn) {
    document.getElementById('modalTitle').innerText = "S·ª≠a s·∫£n ph·∫©m";
    setTimeout(() => {
      document.getElementById('id').value = btn.getAttribute('data-id');
      document.getElementById('name').value = btn.getAttribute('data-name');
      document.getElementById('description').value = btn.getAttribute('data-description');
      document.getElementById('price').value = btn.getAttribute('data-price');
      document.getElementById('quantity').value = btn.getAttribute('data-quantity');
      document.getElementById('category').value=btn.getAttribute('data-category')
    }, 300);
  }

  function getProduct() {
    var key1 = document.getElementById("key1").value;
    window.location.href = "/index/search?key1=" + encodeURIComponent(key1);
  }

  function prdBycate(){
    var cateId = document.getElementById("prdbycate").value
    window.location.href = "/?cateId=" + encodeURIComponent(cateId);
  }
</script>
</body>
</html>
